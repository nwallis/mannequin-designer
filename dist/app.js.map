{"version":3,"sources":["app/designer/joint.shapes.qad.js","app/designer/index.js","node_modules/jade/runtime.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dist/app.js","sourcesContent":["joint.shapes.qad = {};\n\njoint.util.measureText = function(text, attrs) {\n\n    var fontSize = parseInt(attrs.fontSize, 10) || 10;\n\n    var svgDocument = V('svg').node;\n    var textElement = V('<text><tspan></tspan></text>').node;\n    var textSpan = textElement.firstChild;\n    var textNode = document.createTextNode('');\n\n    textSpan.appendChild(textNode);\n    svgDocument.appendChild(textElement);\n    document.body.appendChild(svgDocument);\n\n    var lines = text.split('\\n');\n    var width = 0;\n\n    // Find the longest line width.\n    _.each(lines, function(line) {\n\n        textNode.data = line;\n        var lineWidth = textSpan.getComputedTextLength();\n\n        width = Math.max(width, lineWidth);\n    });\n\n    var height = lines.length * (fontSize * 1.2);\n\n    V(svgDocument).remove();\n\n    return {\n        width: width,\n        height: height\n    };\n};\n\njoint.shapes.qad.TriggerView = joint.dia.ElementView.extend({\n    events: {\n        'click .btn-remove-trigger': 'onRemoveTrigger',\n    },\n    initialize: function(e) {\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n        this.listenTo(this.model, 'change:parent', this.autoresize, this);\n    },\n    autoresize: function() {\n        if (this.getParent()) {\n            var parentBounds = this.getParent().getBBox();\n            this.model.resize(parentBounds.width, 30);\n        }\n    },\n    getParent: function() {\n        return this.model.graph.getCell(this.model.attributes.parent);\n    },\n    onRemoveTrigger: function(evt) {\n        evt.stopPropagation();\n        this.getParent().removeTrigger(this.model.id);\n        this.getParent().unembed(this.model);\n        this.remove();\n    }\n});\n\njoint.shapes.qad.ModifierView = joint.dia.ElementView.extend({\n    events: {\n        'click .btn-remove-modifier': 'onRemoveModifier',\n    },\n    initialize: function(e) {\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n        this.listenTo(this.model, 'change:parent', this.autoresize, this);\n    },\n    autoresize: function() {\n        if (this.getParent()) {\n            var parentBounds = this.getParent().getBBox();\n            this.model.resize(parentBounds.width, 30);\n        }\n    },\n    getParent: function() {\n        return this.model.graph.getCell(this.model.attributes.parent);\n    },\n    onRemoveModifier: function(evt) {\n        this.getParent().removeModifier(this.model.id);\n        this.getParent().unembed(this.model);\n        this.remove();\n    }\n});\n\njoint.shapes.qad.QuestionView = joint.dia.ElementView.extend({\n\n    events: {\n        'click .btn-add-modifier': 'onAddModifier',\n        'click .btn-add-trigger': 'onAddTrigger',\n    },\n\n    initialize: function() {\n        joint.dia.ElementView.prototype.initialize.apply(this, arguments);\n        this.listenTo(this.model, 'change:embeds', this.layoutChildren, this);\n    },\n\n    layoutChildren: function() {\n        this.layoutModifiers();\n        this.layoutTriggers();\n    },\n\n    layoutTriggers: function() {\n        var triggers = this.model.get('triggers');\n        var optionHeight = this.model.get('optionHeight');\n        var offsetY = 70 + (this.model.get('options').length * optionHeight);\n        _.each(triggers, function(trigger) {\n            var cell = this.model.graph.getCell(trigger);\n            cell.position(0, offsetY, {\n                parentRelative: true\n            });\n            offsetY += optionHeight;\n        }, this);\n    },\n\n    layoutModifiers: function() {\n        var options = this.model.get('options');\n        var optionHeight = this.model.get('optionHeight');\n        var offsetY = 50;\n        _.each(options, function(option) {\n            var cell = this.model.graph.getCell(option);\n            cell.position(0, offsetY, {\n                parentRelative: true\n            });\n            offsetY += optionHeight;\n        }, this);\n    },\n\n    onAddTrigger: function() {\n        this.model.addTrigger()\n    },\n    onAddModifier: function() {\n        this.model.addModifier();\n    },\n\n});\n","var app = window.app = {};\nvar qad = window.qad || {};\n\napp.helpers = {\n    export_to_scenario_json: function(graph) {\n\n        var export_data = {\n            \"starting_state\": \"not_yet_set\",\n            \"states\": {}\n        };\n\n        //Get list of links for lookup when adding triggers\n        var graph_links = graph.getLinks();\n        var link_lookup = {};\n\n        for (var link_count = 0; link_count < graph_links.length; link_count++) {\n            var link = graph_links[link_count];\n            link_lookup[link.get('source').id] = link.get('target').id;\n        }\n\n        var state_cells = app.helpers.get_states(graph);\n        for (var state_count = 0; state_count < state_cells.length; state_count++) {\n\n            var state = state_cells[state_count];\n            export_data.states[state.id] = {\n                \"obs\": state.getStateParams().state_data.obs,\n                \"triggers\": {},\n                \"modifiers\": {}\n            };\n\n            //Store the id of the starting state\n            if (state.getStateParams().state_data.initial_state) export_data.starting_state = state.id;\n\n            var state_triggers = state.get('triggers');\n            for (var trigger_count = 0; trigger_count < state_triggers.length; trigger_count++) {\n                var trigger = graph.getCell(state_triggers[trigger_count]);\n                var trigger_data = trigger.getTriggerParams().trigger_data;\n                if (link_lookup[trigger.id]) trigger_data.params[\"linked_state\"] = link_lookup[trigger.id];\n                export_data.states[state.id].triggers[trigger.id] = trigger_data;\n            }\n\n            var state_modifiers = state.get('options');\n            for (var modifier_count = 0; modifier_count < state_modifiers.length; modifier_count++) {\n                var modifier = graph.getCell(state_modifiers[modifier_count]);\n                var modifier_data = modifier.getModifierParams().modifier_data;\n                export_data.states[state.id].modifiers[modifier.id] = modifier_data;\n            }\n\n        }\n\n        return export_data;\n\n    },\n\n    get_states: function(graph) {\n        var state_cells = [];\n        var graph_cells = graph.getCells();\n        for (var cell_count = 0; cell_count < graph_cells.length; cell_count++) {\n            var state = graph_cells[cell_count];\n            if (state.get('type') == 'qad.Question') {\n                state_cells.push(state);\n            }\n\n        }\n        return state_cells;\n    }\n}\n\napp.Factory = {\n\n    createStateFromParams: function(params) {\n        var state = {\n            obs: {},\n            initial_state: false\n        }\n        return state;\n    },\n\n    createModifierFromParams: function(type, params) {\n        var modifier = {\n            type: type || '',\n            params: params || {}\n        }\n        return modifier;\n    },\n\n    createModifierTypeOb: function(time_limit, transition_type, start_time, end_time, relative_amount) {\n        return this.createModifierFromParams(\"Ob\", {\n            \"time_limit\": time_limit || 10,\n            \"transition_type\": transition_type || \"linear\",\n            \"start_time\": start_time || 0,\n            \"end_time\": end_time || 10,\n            \"relative_amount\": relative_amount || 0,\n        });\n    },\n\n    createTriggerFromParams: function(type, params) {\n        var trigger = {\n            type: type || '',\n            params: params || {}\n        }\n        return trigger;\n    },\n\n    createTriggerTypeTimeLimit: function(time_limit, linked_state) {\n        return this.createTriggerFromParams(\"TimeLimit\", {\n            \"time_limit\": time_limit || 10,\n            \"linked_state\": linked_state || ''\n        });\n    },\n\n    createTriggerTypeGiveDrug: function(comparison, drug, dose, dose_unit, linked_state) {\n        return this.createTriggerFromParams(\"GiveDrug\", {\n            \"comparison\": comparison || '',\n            \"drug\": drug || '',\n            \"dose\": dose || 0,\n            \"dose_unit\": dose_unit || '',\n            \"linked_state\": linked_state || ''\n        });\n    },\n\n    createTrigger: function(id, name) {\n        return {\n            id: 'trigger-' + id,\n            attrs: {\n                '.trigger-text': {\n                    text: name\n                }\n            },\n            ports: {\n                groups: {\n                    'out': {\n                        position: 'right',\n                        attrs: {\n                            circle: {\n                                magnet: true,\n                                fill: '#feb663',\n                                r: 14\n                            }\n                        }\n                    }\n                },\n                items: [{\n                    id: 'trigger-port-' + id,\n                    group: 'out',\n                    args: {},\n                }]\n            },\n            trigger_data: app.Factory.createTriggerFromParams()\n        };\n    },\n\n    createModifier: function(id, name) {\n        return {\n            id: 'option-' + id,\n            attrs: {\n                '.option-text': {\n                    text: name\n                }\n            },\n            modifier_data: app.Factory.createModifierFromParams()\n        };\n    },\n\n    createQuestion: function(text) {\n        var q = new joint.shapes.qad.Question({\n            position: {\n                x: 400 - 50,\n                y: 30\n            },\n            size: {\n                width: 100,\n                height: 70\n            },\n            question: text,\n            inPorts: [{\n                id: 'in',\n                label: 'In'\n            }],\n            options: [],\n            triggers: [],\n            state_data: app.Factory.createStateFromParams(text)\n        });\n        return q;\n    },\n\n    createLink: function(source, target) {\n\n        return new joint.dia.Link({\n            source: {\n                id: source\n            },\n            target: {\n                id: target\n            },\n            attrs: {\n                '.marker-target': {\n                    d: 'M 10 0 L 0 5 L 10 10 z',\n                    fill: '#6a6c8a',\n                    stroke: '#6a6c8a'\n                },\n                '.connection': {\n                    stroke: '#6a6c8a',\n                    'stroke-width': 2\n                }\n            }\n        });\n    },\n\n};\n\napp.Selection = Backbone.Collection.extend();\napp.SelectionView = Backbone.View.extend({\n\n    initialize: function(options) {\n        this.options = options;\n        _.bindAll(this, 'render');\n        this.listenTo(this.model, 'add reset change', this.render);\n        this.listenTo(this.model, 'remove', this.remove);\n    },\n\n    render: function() {\n\n        var paper = this.options.paper;\n\n        var boxTemplate = V('rect', {\n            fill: 'none',\n            'stroke': '#C6C7E2',\n            'stroke-width': 1,\n            'pointer-events': 'none'\n        });\n\n        //remove any existing boxes\n        _.invoke(this.boxes, 'remove');\n        this.boxes = [];\n\n        this.model.each(function(element) {\n            var box = boxTemplate.clone();\n            var p = 3; // Box padding.\n            box.attr(g.rect(_.extend({}, element.get('position'), element.get('size'))).moveAndExpand({\n                x: -p,\n                y: -p,\n                width: 2 * p,\n                height: 2 * p\n            }));\n            V(paper.viewport).append(box);\n            this.boxes.push(box);\n        }, this);\n\n        return this;\n    }\n});\n\napp.dictionary = {\n    \"ob_names\": {\n        \"heart_rate\": \"Heart rate\",\n        \"foot_smell\": \"Foot smell\",\n        \"hair_loss\": \"Hair loss\",\n    }\n}\n\napp.AppView = Backbone.View.extend({\n\n    el: '#app-container',\n\n    events: {\n        'click #add-state': 'addState',\n        'click #save-scenario': 'saveScenario',\n    },\n\n    initialize: function() {\n        this.initializePaper();\n        this.initializeSelection();\n        //this.initializeHalo();\n        //this.initializeInlineTextEditor();\n        this.initializeTooltips();\n    },\n\n    initializeTooltips: function() {\n\n        new joint.ui.Tooltip({\n            rootTarget: '#paper',\n            target: '.element',\n            content: _.bind(function(element) {\n\n                var cellView = this.paper.findView(element);\n                var cell = cellView.model;\n\n                var t = '- Double-click to edit text inline.';\n                if (cell.get('type') === 'qad.Question') {\n                    t += '<br/><br/>- Connect a port with another Question or an Answer.';\n                }\n\n                return t;\n\n            }, this),\n            direction: 'right',\n            right: '#paper',\n            padding: 20\n        });\n    },\n\n    initializeHalo: function() {\n\n        this.paper.on('cell:pointerup', function(cellView, evt) {\n\n            if (cellView.model instanceof joint.dia.Link) return;\n\n            var halo = new joint.ui.Halo({\n                graph: this.graph,\n                paper: this.paper,\n                cellView: cellView,\n                useModelGeometry: true,\n                type: 'toolbar'\n            });\n\n            // As we're using the FreeTransform plugin, there is no need for an extra resize tool in Halo.\n            // Therefore, remove the resize tool handle and reposition the clone tool handle to make the\n            // handles nicely spread around the elements.\n            halo.removeHandle('resize');\n            halo.removeHandle('rotate');\n            halo.removeHandle('fork');\n            halo.removeHandle('link');\n            //halo.changeHandle('clone', { position: 'se' });\n\n            halo.on('action:remove:pointerdown', function() {\n                this.selection.reset();\n            }, this);\n\n            halo.render();\n\n        }, this);\n    },\n\n    initializeSelection: function() {\n\n        var selection = this.selection = new app.Selection;\n\n        new app.SelectionView({\n            model: selection,\n            paper: this.paper\n        });\n\n        this.listenTo(this.paper, 'cell:pointerup', function(cellView) {\n            if (!cellView.model.isLink()) {\n                selection.reset([cellView.model]);\n            }\n        });\n\n        this.listenTo(this.paper, 'blank:pointerdown', function() {\n            selection.reset([]);\n        });\n\n        this.listenTo(selection, 'add reset', this.onSelectionChange);\n\n        /* my editor view */\n        app.editor = {\n            triggers: {},\n            modifiers: {},\n        };\n\n        app.editor.StateView = Backbone.View.extend({\n            el: \"#element-type\",\n            initialize: function() {\n                this.template = require('templates/state_parameters.jade');\n                this.render();\n            },\n            events: {\n                \"keyup .ob-value\": \"onObValueChange\",\n                \"change #ob-select\": \"onObChange\",\n                \"keyup #state-name\": \"onTriggerNameChange\",\n                \"click #initial-state-check\": \"onInitialStateClicked\",\n            },\n            onInitialStateClicked: function(evt) {\n                var state_cells = app.helpers.get_states(this.model.graph);\n                state_cells.forEach(function(state) {\n                    state.disableInitialState();\n                });\n                if ($(evt.currentTarget).is(':checked')) this.model.enableInitialState();\n            },\n            onObValueChange: function(evt) {\n                var current_obs = this.model.getStateParams().state_data.obs;\n                var edited_ob_key = $(evt.currentTarget).data('obKey');\n                var enteredValue = evt.currentTarget.value;\n                var newValue = isNaN(parseInt(enteredValue)) ? enteredValue : parseInt(enteredValue);\n                current_obs[edited_ob_key] = newValue;\n            },\n            onObChange: function(evt) {\n                var current_obs = this.model.getStateParams().state_data.obs;\n                var selected_ob = $(evt.currentTarget.selectedOptions[0]);\n                var selected_ob_key = evt.currentTarget.value;\n\n                if (current_obs[selected_ob_key]) {\n                    $(\"#ob-value-\" + selected_ob_key).focus();\n                } else {\n                    current_obs[selected_ob_key] = selected_ob.data('defaultValue');\n                    this.render();\n                }\n\n            },\n            onTriggerNameChange: function(evt) {\n                this.model.attr(\".question-text\", {\n                    text: evt.currentTarget.value\n                });\n            },\n            render: function() {\n                this.$el.html(this.template(this.model.getStateParams()));\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n        app.editor.ModifierView = Backbone.View.extend({\n            el: \"#element-type\",\n            events: {\n                \"change #modifier-type\": \"onModifierTypeChange\",\n                \"change #modifier-name\": \"onModifierNameChange\",\n                \"keyup #modifier-name\": \"onModifierNameChange\",\n            },\n            onModifierNameChange: function(evt) {\n                this.model.attr(\".option-text\", {\n                    text: evt.currentTarget.value\n                });\n            },\n            onModifierTypeChange: function(evt) {\n                if (evt.currentTarget.value != '') {\n                    var new_data = window.app.Factory[\"createModifierType\" + evt.currentTarget.value]();\n                    this.model.set('modifier_data', new_data);\n                    this.createParametersView();\n                }\n            },\n            createParametersView: function(type) {\n                if (this.parameterView) this.parameterView.remove();\n                this.parameterView = new window.app.editor.modifiers[this.model.getModifierParams().modifier_data.type + \"View\"]({\n                    model: this.model.getModifierParams()\n                });\n            },\n            initialize: function() {\n                this.template = require('templates/modifier_type.jade');\n                this.render();\n            },\n            render: function() {\n                this.$el.html(this.template(this.model.getModifierParams()));\n                if (this.model.getModifierParams().modifier_data.type != '') this.createParametersView();\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n        app.editor.EditableModifierView = Backbone.View.extend({\n            storeChangedValue: function(evt) {\n                var enteredValue = evt.currentTarget.value;\n                var newValue = isNaN(parseInt(enteredValue)) ? enteredValue : parseInt(enteredValue);\n                this.model.modifier_data.params[evt.currentTarget.id] = newValue;\n            },\n        });\n\n        app.editor.modifiers.ObView = app.editor.EditableModifierView.extend({\n            el: \"#modifier-parameters\",\n            events: {\n                \"change .select-value-change\": \"storeChangedValue\",\n                \"keyup .keypress-value-change\": \"storeChangedValue\",\n            },\n            initialize: function() {\n                this.template = require('templates/modifier_type_ob.jade');\n                this.render();\n            },\n            render: function() {\n                this.$el.html(this.template(this.model));\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n        app.editor.TriggerView = Backbone.View.extend({\n            el: \"#element-type\",\n            events: {\n                \"change #trigger-type\": \"onTriggerTypeChange\",\n                \"change #trigger-name\": \"onTriggerNameChange\",\n                \"keyup #trigger-name\": \"onTriggerNameChange\",\n            },\n            initialize: function() {\n                this.template = require('templates/trigger_type.jade');\n                this.render();\n            },\n            render: function() {\n                this.$el.html(this.template(this.model.getTriggerParams()));\n                if (this.model.getTriggerParams().trigger_data.type != '') this.createParametersView();\n            },\n            createParametersView: function(type) {\n                if (this.parameterView) this.parameterView.remove();\n                this.parameterView = new window[\"app\"][\"editor\"][\"triggers\"][this.model.getTriggerParams().trigger_data.type + \"View\"]({\n                    model: this.model.getTriggerParams()\n                });\n            },\n            onTriggerTypeChange: function(evt) {\n                if (evt.currentTarget.value != '') {\n                    var new_data = window[\"app\"][\"Factory\"][\"createTriggerType\" + evt.currentTarget.value]();\n                    this.model.set('trigger_data', new_data);\n                    this.createParametersView();\n                }\n            },\n            onTriggerNameChange: function(evt) {\n                this.model.attr(\".trigger-text\", {\n                    text: evt.currentTarget.value\n                });\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n\n        //Trigger classes\n        app.editor.EditableTriggerView = Backbone.View.extend({\n            storeChangedValue: function(evt) {\n                var enteredValue = evt.currentTarget.value;\n                var newValue = isNaN(parseInt(enteredValue)) ? enteredValue : parseInt(enteredValue);\n                this.model.trigger_data.params[evt.currentTarget.id] = newValue;\n            },\n        });\n\n        app.editor.triggers.TimeLimitView = app.editor.EditableTriggerView.extend({\n            el: \"#trigger-parameters\",\n            events: {\n                \"keyup #time_limit\": \"storeChangedValue\",\n            },\n            initialize: function() {\n                this.template = require('templates/trigger_type_time_limit.jade');\n                this.render();\n            },\n            render: function() {\n                this.$el.html(this.template(this.model));\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n        app.editor.triggers.GiveDrugView = app.editor.EditableTriggerView.extend({\n            el: \"#trigger-parameters\",\n            events: {\n                \"change #drug\": \"storeChangedValue\",\n                \"change #dose_unit\": \"storeChangedValue\",\n                \"change #comparison\": \"storeChangedValue\",\n                \"keyup #dose\": \"storeChangedValue\",\n            },\n            initialize: function() {\n                this.template = require('templates/trigger_type_give_drug.jade');\n                this.render();\n            },\n            render: function() {\n                this.$el.html(this.template(this.model));\n            },\n            remove: function() {\n                this.$el.empty().off();\n                this.stopListening();\n                return this;\n            }\n        });\n\n\n    },\n\n    //Each trigger, modifier or whatever is going to have its own logic when it comes to how it manipulates the \n    //data model of the selected element, therefore, each one will live in its own separate view\n    onSelectionChange: function(collection) {\n        var cell = collection.first();\n        if (cell) {\n            var view_type_class;\n            switch (cell.get('type')) {\n                case 'qad.Trigger':\n                    view_type_class = app.editor.TriggerView;\n                    break;\n                case 'qad.Question':\n                    view_type_class = app.editor.StateView;\n                    break;\n                case 'qad.Modifier':\n                    view_type_class = app.editor.ModifierView;\n            }\n\n            if (view_type_class) {\n                //Cleanup parent view if required\n                if (this.parent_view) this.parent_view.remove();\n                this.parent_view = new view_type_class({\n                    model: collection.first()\n                })\n            };\n\n        } else {\n            this.status('Selection emptied.');\n        }\n    },\n\n    initializePaper: function() {\n\n        this.graph = new joint.dia.Graph;\n\n        this.paper = new joint.dia.Paper({\n            el: this.$('#paper'),\n            model: this.graph,\n            width: 800,\n            height: 600,\n            gridSize: 10,\n            snapLinks: {\n                radius: 50\n            },\n            validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {\n                if (magnetS.getAttribute('port-group') !== magnetT.getAttribute('port-group')) return true;\n                return false;\n            },\n            validateMagnet: function(cellView, magnet) {\n                if (magnet.getAttribute('port-group') == 'out') return true;\n                return false;\n            },\n            defaultLink: new joint.dia.Link({\n                router: {\n                    name: 'metro'\n                },\n                connector: {\n                    name: 'rounded'\n                },\n                attrs: {\n                    '.marker-target': {\n                        d: 'M 10 0 L 0 5 L 10 10 z',\n                        fill: '#6a6c8a',\n                        stroke: '#6a6c8a'\n                    },\n                    '.connection': {\n                        stroke: '#6a6c8a',\n                        'stroke-width': 2\n                    }\n                }\n            })\n        });\n    },\n\n\n    // Show a message in the statusbar.\n    status: function(m) {\n        this.$('#statusbar .message').text(m);\n    },\n\n    addState: function() {\n        var q = app.Factory.createQuestion('Question');\n        this.graph.addCell(q);\n        this.status('Question added.');\n    },\n\n    saveScenario: function() {\n        var graph = this.graph;\n        var csrf = document.querySelector(\"meta[name=csrf]\").content;\n        var scenario_data = {\n            scenario: {\n                name: \"ux designed scenario\",\n                data: JSON.stringify(app.helpers.export_to_scenario_json(graph)),\n                rappid_data: JSON.stringify(graph.toJSON())\n            }\n        }\n\n        $.ajax({\n            url: \"/scenarios\",\n            type: \"post\",\n            data: scenario_data,\n            headers: {\n                \"X-CSRF-TOKEN\": csrf\n            },\n            dataType: \"json\",\n            success: function(data) {\n                console.log(data);\n            }\n        });\n    },\n\n    clear: function() {\n        this.graph.clear();\n    },\n\n});\n\n$(function() {\n\n    joint.dia.Element.define('qad.Trigger', {\n        attrs: {\n            '.btn-remove-trigger': {\n                'x-alignment': 10,\n                'y-alignment': 13,\n                cursor: 'pointer',\n                fill: 'black'\n            },\n            '.trigger-rect': {\n                fill: '#777777',\n                stroke: 'none',\n                width: 100,\n                height: 60,\n            },\n            '.trigger-text': {\n                'font-size': 11,\n                fill: 'white',\n                'y-alignment': .7,\n                'x-alignment': 40\n            }\n        }\n    }, {\n        markup: require('templates/trigger')(),\n        getTriggerParams: function() {\n            return {\n                trigger_data: this.get('trigger_data'),\n                model_name: this.get('attrs')['.trigger-text'].text\n            }\n        }\n    });\n\n    joint.dia.Element.define('qad.Modifier', {\n        attrs: {\n            '.btn-remove-modifier': {\n                'x-alignment': 10,\n                'y-alignment': 13,\n                cursor: 'pointer',\n                fill: 'black'\n            },\n            '.option-rect': {\n                fill: '#777777',\n                stroke: 'none',\n                width: 100,\n                height: 60,\n            },\n            '.option-text': {\n                'font-size': 11,\n                fill: 'white',\n                'y-alignment': .7,\n                'x-alignment': 40\n            }\n        }\n    }, {\n        markup: require('templates/modifier')(),\n        getModifierParams: function() {\n            return {\n                modifier_data: this.get('modifier_data'),\n                model_name: this.get('attrs')['.option-text'].text\n            }\n        }\n    });\n\n    joint.dia.Element.define('qad.Question', {\n\n        optionHeight: 30,\n        questionHeight: 50,\n        paddingBottom: 20,\n        minWidth: 150,\n        ports: {\n            groups: {\n                'in': {\n                    position: 'top',\n                    attrs: {\n                        circle: {\n                            magnet: true,\n                            stroke: 'white',\n                            fill: '#feb663',\n                            r: 14\n                        },\n                        text: {\n                            'pointer-events': 'none',\n                            'font-size': 12,\n                            fill: 'white'\n                        }\n                    },\n                    label: {\n                        position: {\n                            name: 'left',\n                            args: {\n                                x: 5\n                            }\n                        }\n                    }\n                }\n            },\n            items: [{\n                group: 'in',\n                attrs: {\n                    text: {\n                        text: 'in'\n                    }\n                }\n            }]\n        },\n        attrs: {\n            '.': {\n                magnet: false\n            },\n            '.options': {\n                ref: '.body',\n                'ref-x': 0\n            },\n            '.body': {\n                width: 150,\n                height: 250,\n                rx: '1%',\n                ry: '2%',\n                stroke: 'none',\n                fill: {\n                    type: 'linearGradient',\n                    stops: [{\n                        offset: '0%',\n                        color: '#FEB663'\n                    }, {\n                        offset: '100%',\n                        color: '#31D0C6'\n                    }],\n                    // Top-to-bottom gradient.\n                    attrs: {\n                        x1: '0%',\n                        y1: '0%',\n                        x2: '0%',\n                        y2: '100%'\n                    }\n                }\n            },\n            '.btn-add-modifier': {\n                ref: '.body',\n                'ref-x': 10,\n                'ref-dy': -22,\n                cursor: 'pointer',\n                fill: 'white'\n            },\n            '.btn-add-trigger': {\n                ref: '.body',\n                refX: 40,\n                refDy: -22,\n                cursor: 'pointer',\n                fill: 'blue'\n            },\n            '.btn-remove-trigger': {\n                'x-alignment': 10,\n                'y-alignment': 13,\n                cursor: 'pointer',\n                fill: 'white'\n            },\n            '.triggers': {\n                ref: '.body',\n                'ref-x': 0\n            },\n            // Text styling.\n            text: {\n                'font-family': 'Arial'\n            },\n            '.question-text': {\n                fill: 'white',\n                refX: '50%',\n                refY: 15,\n                'font-size': 15,\n                'text-anchor': 'middle',\n                style: {\n                    'text-shadow': '1px 1px 0px gray'\n                }\n            },\n\n            // Options styling.\n            '.trigger-bg-rect': {\n                rx: 3,\n                ry: 3,\n                stroke: 'white',\n                'stroke-width': 1,\n                'stroke-opacity': .5,\n                'fill-opacity': .5,\n                fill: 'green',\n                ref: '.body',\n                'ref-width': 1\n            }\n\n        }\n    }, {\n\n        //refactor this to common class functions\n        getStateParams: function() {\n            return {\n                state_data: this.get('state_data'),\n                model_name: this.get('attrs')[\".question-text\"].text\n            };\n        },\n        disableInitialState: function() {\n            var state_data = JSON.parse(JSON.stringify(this.get('state_data')));\n            state_data.initial_state = false;\n            this.attr('.body', {\n                width: 150,\n                height: 250,\n                rx: '1%',\n                ry: '2%',\n                stroke: 'none',\n                fill: {\n                    type: 'linearGradient',\n                    stops: [{\n                        offset: '0%',\n                        color: '#FEB663'\n                    }, {\n                        offset: '100%',\n                        color: '#31D0C6'\n                    }],\n                    // Top-to-bottom gradient.\n                    attrs: {\n                        x1: '0%',\n                        y1: '0%',\n                        x2: '0%',\n                        y2: '100%'\n                    }\n                }\n            });\n            this.set('state_data', state_data);\n        },\n        enableInitialState: function() {\n            var state_data = JSON.parse(JSON.stringify(this.get('state_data')));\n            state_data.initial_state = true;\n            this.attr('.body', {\n                width: 150,\n                height: 250,\n                rx: '1%',\n                ry: '2%',\n                stroke: 'none',\n                fill: {\n                    type: 'linearGradient',\n                    stops: [{\n                        offset: '0%',\n                        color: '#000000'\n                    }, {\n                        offset: '100%',\n                        color: '#31D0C6'\n                    }],\n                    // Top-to-bottom gradient.\n                    attrs: {\n                        x1: '0%',\n                        y1: '0%',\n                        x2: '0%',\n                        y2: '100%'\n                    }\n                }\n            });\n            this.set('state_data', state_data);\n        },\n\n        markup: require('templates/question.jade')(),\n        optionMarkup: require('templates/trigger.jade')(),\n        triggerMarkup: require('templates/modifier.jade')(),\n\n        initialize: function() {\n            joint.dia.Element.prototype.initialize.apply(this, arguments);\n            this.listenTo(this, 'change:options', this.onChangeModifiers, this);\n            this.listenTo(this, 'change:triggers', this.autoresize, this);\n            this.on('change:question', function() {\n                this.attr('.question-text/text', this.get('question') || '');\n                this.autoresize();\n            }, this);\n            this.on('change:questionHeight', function() {\n                this.attr('.options/ref-y', this.get('questionHeight'), {\n                    silent: true\n                });\n                this.autoresize();\n            }, this);\n            this.on('change:optionHeight', this.autoresize, this);\n            this.attr('.options/ref-y', this.get('questionHeight'), {\n                silent: true\n            });\n            this.attr('.question-text/text', this.get('question'), {\n                silent: true\n            });\n        },\n\n        onChangeModifiers: function(e, f, g, h) {\n            var modifiers = this.get(\"options\");\n            _.each(modifiers, function(modifier) {}, this);\n            this.autoresize();\n        },\n\n        onChangeTriggers: function() {\n            //Get values from model to keep code get() free\n            /*var triggers = this.get('triggers');\n              var optionHeight = this.get('optionHeight');\n              var attrs = this.get('attrs');\n              var questionHeight = this.get('questionHeight');\n              var offsetY = (this.get('options').length * optionHeight) + ((this.get('options').length > 0) ? 70 : 50);\n              var attrsUpdate = {};*/\n\n            //iterate attributes for each selector\n            _.each(attrs, function(attrs, selector) {\n                if (attrs.dynamicmodifier) {\n                    this.removeAttr(selector, {\n                        silent: true\n                    });\n                }\n            }, this);\n\n            // Collect new attrs for the new options - marking them as dynamicmodifier for potential cleanup\n            _.each(triggers, function(trigger) {\n\n                var selector = '.trigger-' + trigger.id;\n\n                attrsUpdate[selector] = {\n                    transform: 'translate(0, ' + offsetY + ')',\n                    dynamicmodifier: true\n                };\n                attrsUpdate[selector + ' .trigger-bg-rect'] = {\n                    height: optionHeight,\n                    dynamicmodifier: true\n                };\n                attrsUpdate[selector + ' .option-text'] = {\n                    text: trigger.text,\n                    dynamicmodifier: true\n                };\n\n                offsetY += optionHeight;\n                var portY = offsetY - optionHeight / 2; // + questionHeight;\n                if (!this.getPort(trigger.id)) {\n                    this.addPort({\n                        group: 'out',\n                        id: trigger.id,\n                        args: {\n                            y: portY\n                        }\n                    });\n                } else {\n                    this.portProp(trigger.id, 'args/y', portY);\n                }\n\n            }, this);\n\n            this.attr(attrsUpdate);\n        },\n\n        autoresize: function() {\n            var options = this.get('options');\n            var triggers = this.get('triggers');\n            var gap = this.get('paddingBottom') || 20;\n            var height = options.length * this.get('optionHeight') + this.get('questionHeight') + gap;\n            height += triggers.length * this.get('optionHeight') + (gap * 2);\n            var width = joint.util.measureText(this.get('question'), {\n                fontSize: this.attr('.question-text/font-size')\n            }).width;\n            this.resize(Math.max(this.get('minWidth') || 150, width), height);\n        },\n\n        addModifier: function() {\n            var modifier_model = app.Factory.createModifier(_.uniqueId(), \"Modifier \" + this.get('options').length);\n            this.addElementToStore('options', modifier_model.id);\n            var modifier_view = new joint.shapes.qad.Modifier(modifier_model);\n            this.graph.addCell(modifier_view);\n            this.embed(modifier_view);\n        },\n        addTrigger: function() {\n            var trigger_model = app.Factory.createTrigger(_.uniqueId(), \"Trigger \" + this.get('triggers').length);\n            this.addElementToStore('triggers', trigger_model.id);\n            var trigger_view = new joint.shapes.qad.Trigger(trigger_model);\n            this.graph.addCell(trigger_view);\n            this.embed(trigger_view);\n        },\n        removeElementById: function(id, storage_key) {\n            var data_store = this.get(storage_key);\n            this.removePort(id);\n            data_store = _.without(data_store, _.findWhere(data_store, {\n                id: id\n            }));\n            return data_store;\n        },\n        removeModifier: function(id) {\n            this.set('options', this.removeElementById(id, 'options'));\n        },\n        removeTrigger: function(id) {\n            this.set('triggers', this.removeElementById(id, 'triggers'))\n        },\n        addElementToStore: function(storage_key, item) {\n            this.set(storage_key, this.get(storage_key).concat(item));\n        }\n    });\n\n    window.appView = new app.AppView;\n\n});\n","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.jade = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/**\n * Merge two attribute objects giving precedence\n * to values in object `b`. Classes are special-cased\n * allowing for arrays and merging/joining appropriately\n * resulting in a string.\n *\n * @param {Object} a\n * @param {Object} b\n * @return {Object} a\n * @api private\n */\n\nexports.merge = function merge(a, b) {\n  if (arguments.length === 1) {\n    var attrs = a[0];\n    for (var i = 1; i < a.length; i++) {\n      attrs = merge(attrs, a[i]);\n    }\n    return attrs;\n  }\n  var ac = a['class'];\n  var bc = b['class'];\n\n  if (ac || bc) {\n    ac = ac || [];\n    bc = bc || [];\n    if (!Array.isArray(ac)) ac = [ac];\n    if (!Array.isArray(bc)) bc = [bc];\n    a['class'] = ac.concat(bc).filter(nulls);\n  }\n\n  for (var key in b) {\n    if (key != 'class') {\n      a[key] = b[key];\n    }\n  }\n\n  return a;\n};\n\n/**\n * Filter null `val`s.\n *\n * @param {*} val\n * @return {Boolean}\n * @api private\n */\n\nfunction nulls(val) {\n  return val != null && val !== '';\n}\n\n/**\n * join array as classes.\n *\n * @param {*} val\n * @return {String}\n */\nexports.joinClasses = joinClasses;\nfunction joinClasses(val) {\n  return (Array.isArray(val) ? val.map(joinClasses) :\n    (val && typeof val === 'object') ? Object.keys(val).filter(function (key) { return val[key]; }) :\n    [val]).filter(nulls).join(' ');\n}\n\n/**\n * Render the given classes.\n *\n * @param {Array} classes\n * @param {Array.<Boolean>} escaped\n * @return {String}\n */\nexports.cls = function cls(classes, escaped) {\n  var buf = [];\n  for (var i = 0; i < classes.length; i++) {\n    if (escaped && escaped[i]) {\n      buf.push(exports.escape(joinClasses([classes[i]])));\n    } else {\n      buf.push(joinClasses(classes[i]));\n    }\n  }\n  var text = joinClasses(buf);\n  if (text.length) {\n    return ' class=\"' + text + '\"';\n  } else {\n    return '';\n  }\n};\n\n\nexports.style = function (val) {\n  if (val && typeof val === 'object') {\n    return Object.keys(val).map(function (style) {\n      return style + ':' + val[style];\n    }).join(';');\n  } else {\n    return val;\n  }\n};\n/**\n * Render the given attribute.\n *\n * @param {String} key\n * @param {String} val\n * @param {Boolean} escaped\n * @param {Boolean} terse\n * @return {String}\n */\nexports.attr = function attr(key, val, escaped, terse) {\n  if (key === 'style') {\n    val = exports.style(val);\n  }\n  if ('boolean' == typeof val || null == val) {\n    if (val) {\n      return ' ' + (terse ? key : key + '=\"' + key + '\"');\n    } else {\n      return '';\n    }\n  } else if (0 == key.indexOf('data') && 'string' != typeof val) {\n    if (JSON.stringify(val).indexOf('&') !== -1) {\n      console.warn('Since Jade 2.0.0, ampersands (`&`) in data attributes ' +\n                   'will be escaped to `&amp;`');\n    };\n    if (val && typeof val.toISOString === 'function') {\n      console.warn('Jade will eliminate the double quotes around dates in ' +\n                   'ISO form after 2.0.0');\n    }\n    return ' ' + key + \"='\" + JSON.stringify(val).replace(/'/g, '&apos;') + \"'\";\n  } else if (escaped) {\n    if (val && typeof val.toISOString === 'function') {\n      console.warn('Jade will stringify dates in ISO form after 2.0.0');\n    }\n    return ' ' + key + '=\"' + exports.escape(val) + '\"';\n  } else {\n    if (val && typeof val.toISOString === 'function') {\n      console.warn('Jade will stringify dates in ISO form after 2.0.0');\n    }\n    return ' ' + key + '=\"' + val + '\"';\n  }\n};\n\n/**\n * Render the given attributes object.\n *\n * @param {Object} obj\n * @param {Object} escaped\n * @return {String}\n */\nexports.attrs = function attrs(obj, terse){\n  var buf = [];\n\n  var keys = Object.keys(obj);\n\n  if (keys.length) {\n    for (var i = 0; i < keys.length; ++i) {\n      var key = keys[i]\n        , val = obj[key];\n\n      if ('class' == key) {\n        if (val = joinClasses(val)) {\n          buf.push(' ' + key + '=\"' + val + '\"');\n        }\n      } else {\n        buf.push(exports.attr(key, val, false, terse));\n      }\n    }\n  }\n\n  return buf.join('');\n};\n\n/**\n * Escape the given string of `html`.\n *\n * @param {String} html\n * @return {String}\n * @api private\n */\n\nvar jade_encode_html_rules = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;'\n};\nvar jade_match_html = /[&<>\"]/g;\n\nfunction jade_encode_char(c) {\n  return jade_encode_html_rules[c] || c;\n}\n\nexports.escape = jade_escape;\nfunction jade_escape(html){\n  var result = String(html).replace(jade_match_html, jade_encode_char);\n  if (result === '' + html) return html;\n  else return result;\n};\n\n/**\n * Re-throw the given `err` in context to the\n * the jade in `filename` at the given `lineno`.\n *\n * @param {Error} err\n * @param {String} filename\n * @param {String} lineno\n * @api private\n */\n\nexports.rethrow = function rethrow(err, filename, lineno, str){\n  if (!(err instanceof Error)) throw err;\n  if ((typeof window != 'undefined' || !filename) && !str) {\n    err.message += ' on line ' + lineno;\n    throw err;\n  }\n  try {\n    str = str || require('fs').readFileSync(filename, 'utf8')\n  } catch (ex) {\n    rethrow(err, null, lineno)\n  }\n  var context = 3\n    , lines = str.split('\\n')\n    , start = Math.max(lineno - context, 0)\n    , end = Math.min(lines.length, lineno + context);\n\n  // Error context\n  var context = lines.slice(start, end).map(function(line, i){\n    var curr = i + start + 1;\n    return (curr == lineno ? '  > ' : '    ')\n      + curr\n      + '| '\n      + line;\n  }).join('\\n');\n\n  // Alter exception message\n  err.path = filename;\n  err.message = (filename || 'Jade') + ':' + lineno\n    + '\\n' + context + '\\n\\n' + err.message;\n  throw err;\n};\n\nexports.DebugItem = function DebugItem(lineno, filename) {\n  this.lineno = lineno;\n  this.filename = filename;\n}\n\n},{\"fs\":2}],2:[function(require,module,exports){\n\n},{}]},{},[1])(1)\n});"]}